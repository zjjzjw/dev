![20210918153803_58d1b13692a28c986e09e7636731ef13.png](https://zjj-1307432767.cos.ap-shanghai.myqcloud.com/20210918153803_58d1b13692a28c986e09e7636731ef13.png?q-sign-algorithm=sha1&q-ak=AKIDvgBQO5VeWZMs74l8G7gyzjCPL1RbU5PU&q-sign-time=1631950683;1663486683&q-key-time=1631950683;1663486683&q-header-list=&q-url-param-list=&q-signature=1836bda66a8e8d483eed6d5a62a6dbf75b6a26e2)



一  预防能力标准
第一条 要有明确的变更流程和变更规范。
解决问题：变更管理权限混乱、无明确通报机制和流程规范，给线上带来无数隐患、也直接影响线上问题定位和止损效率。

要求：需要有明确的变更流程，主要包括：上线前的测试方案和风险评估，上线的权限管理、时间窗口、通报机制等。

说明：BUG修复类、只能在低峰期进行变更、变更持续时间长的特殊情况，可以设置特殊的窗口和流程规范，但不能无章可循。

标准：

1.有明确的时间窗口，特别是对于时间窗口之外的上线有完善的紧急流程规范；

2.有明确的上线权限管理和通报机制；

3.有完善的检查回归手段；

验证手段：如所使用的变更平台属于opstable认证范围内的平台，通过将变更数据推送至ODW平台，由ODW平台自动审计。

判例：无

指标级别：1

对应角色：OP、RD、QA

第二条  线上、线下应进行隔离。
指标解释：线上、线下隔离是指将线上环境与线下环境隔离开，不允许线下服务在授权外访问线上服务。

指标要求：原则上，线上与线下进行隔离，避免线下压力、异常流量发送到线上，影响线上服务。确因特殊需求，需要线下连接线上的，通过例外授权进行。其中对线上压测和写线上的需求，不得例外授权。

标准：

1．已通过技术手段（如giano）对所有核心模块实施线上、线下隔离；

2．可通过技术手段（如giano）实现隔离例外授权控制，其中对线上压测和写线上的需求，不得例外授权；

验证手段：从实现隔离的技术平台（如giano平台）获取线上、线下隔离策略数据。

判例：2015年03月24日，RD线下测压，压垮passport线上服务 导致用户登录失败。

指标级别：2

对应角色：OP、RD

第三条 线上各类操作需要制定相应的操作准则。
指标解释：运维操作规范指针对OP的线上操作行为制定相应的操作准则。线上操作包括程序、数据变更，配置修改，数据获取，故障处置，增加或下线机器、环境清理等对线上产品环境进行变更的行为。

指标要求：对OP线上操作需要制定操作规范，常规类操作需明确操作流程和技术要求；非常规类操作，规范中至少需额外增加对审批流程、操作前后通报机制、操作后验证机制、操作分级进行的要求。运维操作规范需定期review。

标准：

1．OP线上操作（包括常规和非常规），明确操作流程和技术要求；

2．OP非常规类操作，制定审批流程，操作前后有通报机制，操作后有验证机制，有操作分级要求；

运维操作规范每年review一次；

验证手段：

1．产品线提交运维操作规范文档。

2．抽样检查或产品线提交操作审批记录、操作通报记录、操作后验证记录、操作分级记录。

3．抽样检查或产品线提交运维操作规范review记录。

判例：无。

指标级别：2

对应角色：OP

第四条  需要进行安全审计。
指标解释：安全审计指将实际操作行为与安全规则进行对比，发现日常操作中存在的违规、高风险行为，是基础运维风险事后管控的重要措施。

指标要求：各产品线应对如下方面进行安全审计：

非法登录；人员与权限不匹配情况；超级、区域总控授权、操作行为审计；线下连线上行为审计；初始化平台操作行为审计。

标准：

对非法登录审计，对人员与权限不匹配审计，对超级、区域总控审计，线下连线上审计，初始化平台操作审计。

验证手段：

通过giano平台获取或产品线提交审计报告。

判例：无

指标级别：2

对应角色：OP

第五条  需要有效防御攻击行为。
指标解释：网络攻击行为由于其突发性的大流量，消耗大量网络资源或超出系统的服务能力，导致系统崩溃，无法为正常用户提供服务。

指标要求：对常见攻击有识别、防御的能力。攻击种类包括dns攻击、syn flood/udp flood、cc、waf防御类。对攻击类型识别和防御评估覆盖率（参照常见攻击列表评估），对攻击到来、识别、防御评估生效速度。大规模攻击时可在运营商侧封禁被攻击ip，避免持续影响机房出口，产品线应制定ip封禁预案，提前约定明确的封禁阈值。

标准：

1．完备性：可有效防御所有常见攻击行为；

2．精细化：可针对不同流量来源、不同模块进行防攻击；

3．高效性：攻击行为可在2分钟内被识别并防御的，不需要人工识别攻击行为后添加策略；

验证手段：

访谈

判例：用户产品需要有基本的防攻击策略，进行流量清洗，保护服务。例如，2015.7.1，贴吧核心服务frs页受攻击导致该服务异常，由于贴吧防攻击策略被关闭导致分布式防攻击策略未第一时间生效；frs本身流量在贴吧整体流量占比很少，因此攻击导致的流量增长未能第一时间发现。故障持续时间1小时。

指标级别：2

对应角色：OP、RD

第六条  需要有明确的容量规划、数据，并定期更新。
指标解释：明确的容量数据是应对服务流量波动及故障时流量调度的重要依据。没有最新的容量数据，会导致流量调度时无法快速决策，或者执行后出现预期外问题反而对服务造成损失。

指标要求：对于每个逻辑服务单元，需要有明确的容量数据，并定期更新。

对于流量的变化趋势，年度变化特征，有贴近实际情况的预估，重点关注重大事件（如节日/运营/假期/新闻）。

标准：

1．完备性：对所有逻辑服务单元均有明确的容量数据，且覆盖其下的核心功能；

2．实测性：容量数据为针对线上实际环境测试得到，而非线下模拟和推演得到的；

3．时新性：容量数据有定期更新机制，且周期小于1个月；

4．预测：有对全年关键节点的流量预估机制，节点到来前一周可给出预估数据，无或者不能提前一周；

验证手段：

提交容量评估系统或工具中的线上容量压测记录、容量评估记录以及容量预测机制和预测记录。

判例：无

指标级别：1

对应角色：OP

第七条  服务应拆分为彼此隔离的逻辑单元
指标解释：逻辑服务单元拆分，可以将局部网络、机房故障对产品线的影响隔离在一定物理范围内，避免故障给产品线服务带来全局性影响。

指标要求：

将服务拆分为若干不同的逻辑单元，每个逻辑单元处于不同的物理机房，均能提供产品线完整服务，且服务容量支持N+1冗余，即任意一个逻辑单元发生故障时，可将流量切换至其他逻辑单元，保证继续向用户正常提供服务。

标准：

服务全混连，不得分。

内部核心服务做了逻辑机房拆分；

内部非核心服务做了彻底（单逻辑机房故障不影响其他机房的服务）的逻辑机房拆分；

外部关键依赖做了逻辑机房拆分；

验证手段：

review服务部署的逻辑分布以及连接关系

判例：比如:糯米服务在华东分为了多个逻辑机房，而BFE在华东只有一个逻辑机房，这样在BFE看来单个逻辑机房的异常就会影响到糯米服务的多个逻辑机房。

指标级别：1

对应角色：OP、RD

第八条 核心功能应与非核心功能逻辑独立
指标解释：若不能做到核心功能与非核心功能的业务逻辑独立，而将二者耦合在一起，那么核心功能将受制于低可用性保证的非核心功能，其高可用性无法得到保证。

指标要求：

1. 根据产品key feature，明确核心功能与非核心功能，并定义对应的可用性指标。

2. 核心与非核心功能在服务逻辑处理上相互独立互不影响，尤其是非核心功能异常时不能影响核心功能完成，必要时丢弃非核心功能以保证核心功能的高可用。

标准：

核心/非核心功能有明确区分；

核心／非核心功能得业务逻辑独立，可支持核心服务的所有非核心功能降级；

验证手段：

服务盲测，针对非核心功能进行停服务、注入异常等方式来检测系统实际的表现。

判例：www检索服务依赖很多远程词典，应该做到在外部词典服务异常的时候不影响正常的检索服务。例如，2014-12-20,www的词典服务器依赖的zookeeper异常，由于代码问题，在zookeeper异常时会将本地的词典服务器连接关系配置清空，最终导致影响大量的aladdin结果不能展现。

指标级别：2

对应角色：OP、RD

第九条  线上变更应严格遵循分级发布
指标解释：将一次线上变更过程按照操作的服务实例分为若干个阶段，在每个阶段引入自动化的检查case，希望在更早的阶段发现问题，避免影响面扩散。 分级发布不是裁剪或者弱化线下测试步骤，不能取代线下的测试。

指标要求：

1、按可用性隔离域（一般为逻辑IDC）依次进行。

2、调用服务 SLA 监控实施自动检查。

标准：

有线下隔离域；

若产品线有N 个逻辑隔离域，优先部署其中的一个；

剩余N-1个逻辑隔离域串行部署；

每个逻辑隔离域部署完之后有 SLA 监控自动化检查；

验证手段：

所使用的变更平台属于 opstable 认证范围内的平台。通过将变更数据推送到 odw，由 odw 自动审计。

判例：无。

指标级别：1

对应角色：OP、QA、RD

第十条  不同逻辑单元总控机应隔离
指标解释：登录隔离指按照逻辑服务单元将产品线划分成若干业务隔离域，隔离域之间不可通过门神免密机制进行互访，登录隔离可以将误操作影响范围控制在单个逻辑单元内，规避全局影响，降低日常运维工作的操作风险。

指标要求：

按照逻辑服务单元将产品线划分成若干业务隔离域，隔离域之间不可通过门神免密机制进行互访，考虑到预案执行、批量任务等一些需要全量操作的特殊场景，每个业务隔离域对应设置一个区域总控域，区域总控域可通过门神免密机制访问其对应区域内的任意服务器；每个产品线设置一个超级总控域，超级总控域可通过门神免密机制访问该产品线内任意服务器，超级总控权限需进行严格管理，只为少数必须操作总控的人员分配权限。

建立应急机制，超级总控异常时，可关闭隔离开关进行应急，默认产品线经理拥有变更登录隔离开关权限。

标准：

核心服务按要求划分业务隔离域；

非核心服务按要求划分业务隔离域；

可以做到消除超级总控和区域总控的，仍保留总控，对超级总控权限按要求进行管理；

验证手段：

隔离域划分：从Giano平台获取。

超级总控权限管理：从Giano平台、noah平台、超级总控机配置获取。

应急机制：登录隔离应急操作文档。

判例：网页搜索按逻辑服务单元划分为6个业务隔离域，设置6个区域总控和1个超级总控。通过noah和超级总控ssh配置方式进行权限管理。

指标级别：1

对应角色：OP

第十一条  严格限制信任关系
指标解释：信任关系指通过设定相关配置，一台服务器上的一个用户信任另一台服务器上的一个用户，允许这个用户不输入密码登录。信任关系的过度使用，会带来安全隐患：上游机器的健康度直接关联到下游机器，若上游机器被攻破，下游机器也就不攻而破。另外，通过信任关系登录无法审计到个人，对于后续的审计追踪带来较大困难。

指标要求：

服务器登录方式遵照门神系统+登录隔离的方案，保留线上服务器至超级总控的信任关系，此信任关系作为上述方案的应急备用登录方式，且由Giano来做全局管理。其他信任关系全部下线。

评分标准：

只保留了线上服务器至超级总控的信任关系；

信任关系已纳入giano管理的；

验证手段：

从Giano中获取产品线服务器登录数据，判断其中是否存在通过信任关系登录现象。

从Giano中获取产品线信任关系全局管理配置数据。

判例：目前各产品线信任关系配置较多且分散，上游机器的健康度直接关联到下游机器，若上游机器被攻破，下游机器也就不攻而破，存在较大的安全隐患。

指标级别：1

对应角色：OP

二 发现/感知故障能力标准
第十二条  内部关键服务感知满足覆盖度、及时性、精准性、报警升级能力要求
指标解释：内部关键服务是指产品线保证其核心功能正常，所必须具备的服务，此类服务一般不可被完全降级，其状态清晰对大规模故障问题定位、异常影响面的判断、支撑预案决策起关键作用。

指标要求：

1、覆盖度：状态感知需覆盖全部内部关键服务；

2、及时性：关键服务异常需及时感知（< =60秒）；

3、精准性：异常类型需进行分类，包括超时、拒绝、无结果、特定错误码等，需要有实时异常率数据；

4、报警策略：异常报警需要有报警升级策略，报警在预期时间内未恢复正常时及时告知其他相关人员参与止损

标准：

1、及时性：内部关键服务异常感知时间<=60s；

2、精确性：对内部关键服务异常状态实时进行分类(如错误是超时、拒绝、还是无结果），有实时异常率数据；

3、报警策略：有对应报警升级策略(如电话等)升级至经理与非值班高工；

验证手段：

模拟/实测核心服务异常，验证报警、采集状态。

判例：

指标级别：1

对应角色：OP、RD

第十三条  关键上游服务感知满足覆盖度、及时性、精准性、报警升级能力要求
指标解释：关键上游服务是指承载了本产品线/平台重要流量来源的外部服务（如凤巢的关键上游是大搜），或者是本产品线/平台核心的服务调用者（如MOLA平台的关键上游是贴吧、展示广告），对关键上游服务 感知到的本服务故障，需要快速、准确知晓。

指标要求：

1、覆盖度：状态感知需覆盖关键上游服务；

2、及时性：关键服务异常需及时感知（< =300秒）；

3、精准性：异常结果需要分类，包括：分逻辑机房或分异常种类(超时、拒绝、无结果、特定错误码)，需要有实时kpi数据；

4、报警策略：异常报警需要有报警升级策略，让足够的人能参与止损。

标准：

1、及时性：关键上游服务感知异常时间小于300秒；

2、精确性：对关键上游服务->自身异常状态能分机房、分异常种类实时展示、有实时kpi。

3、报警策略：有对应报警升级策略(如电话等)升级至经理与非值班高工。

验证手段：

与上游进行联合演练，把流量切走，任意停止下游服务，判断上游是否能感知。

判例：无

指标级别：1

对应角色：OP、RD

三 止损与响应能力标准
第十四条  每个逻辑机房有一个或者多个vip出口，可执行外网流量调度
指标分类：止损能c力/调度

指标解释：外网流量调度是指对于有外网接入的服务，在机房内/外网故障的情况下，通过变更域名到vip映射关系，使流量绕过故障机房，从而达到止损的目的。

指标要求：

每个逻辑机房有一个或者多个vip出口；外网流量接入需满足运营商复杂度和地域复杂度要求；流量切换预案需覆盖单机房、同地域运营商维度；流量切换需满足时效性以及正确性要求。

标准：

1、完备性：

  1）vip接入完备性：vip接入覆盖联通、移动、电信三大运营商，且tdo配置不存在跨运营商访问情况。华东、华北、华南至少两个地域有接入vip，运营商覆盖率和地域覆盖率；

  2）切换预案完备性：外网预案至少覆盖单机房以及地域运营商（如华北电信）维度；

2、正确性：

  1）故障机房流量100%正常切走。全部切走；

  2）故障机房流量优先切换到同运营商机房；

3、时效性：

  1）能实现自动容错，故障发生到开始执行切换时间<=2分钟；

  2）开始执行切换到故障机房90%流量切走的时间不超过5分钟；

验证手段：

vip接入完备性：通过猎鹰平台来验证。

预案完备性：通过扫描产品线录入的预案来验证。

正确性和时效性：通过盲测平台来跟踪切换过程，验证切换正确性和时效性。

判例：

展示广告pos域名在华东、华北、华南都有接入，覆盖联通、移动、电信、bgp等运营商。预案覆盖单机房和地域运营商。满足完备性要求。

指标级别：1

对应角色：OP、SYS

第十五条  具备内网流量调度，切换整个逻辑机房快速止损的能力
指标分类：止损能力/调度

指标解释：产品线需要有能力在内网调度自身流量，以应对个别逻辑机房内服务出现的各种异常情况。

指标要求：

需具备切换整个逻辑机房的能力，以便单逻辑机房任意模块异常时能快速止损；进一步宜具备单独调度内部核心子系统\子模块流量的能力，以减少整个逻辑机房切换带来的叠加影响。

整个逻辑机房切换和内部核心子系统\子模块流量调度，都应做到调度速度尽量快，调度精度尽量小。针对日常故障，宜综合考虑容量、系统架构，实现自动流量切换，快速止损。

标准：

1、针对日常故障，流量调度决策自动执行；

2、作出切换决策后，调度生效速度<60s；

3、调度精度定义为：1-实际生效的流量/预期生效的流量。精度<=10％；

验证手段：

执行流量切换验证各种能力以及覆盖度达标情况。

判例：

流量调度是故障时最为快速的止损手段。例如2013.09.11，st01机房光纤挖断，由于贴吧将近一半机器部署在st01，且后端服务为全混连，无法进行有效的问题隔离和流量调度，加之超时重试不合理，导致贴吧服务中断4个小时。

指标级别：1

对应角色：OP

第十六条  应结合本产品线实际情况，明确故障应急响应的组织方式与处置流程
指标分类：止损能力

指标解释：故障应急响应指的是，为使产品线突发故障得到有效控制，最大限度减小故障损失，而采取的一系列措施。

指标要求：

各产品线应结合本产品线实际情况，明确故障应急响应的组织方式与处置流程，具体包括：故障指挥协调、对外沟通、故障应急过程记录、故障分析判断、决策处置、故障升级。

标准：

各产品线应制定故障应急处置规范，明确故障应急响应的组织方式与处置流程，具体包括故障指挥协调、对外沟通、故障应急过程记录、故障分析判断、决策处置、故障升级6方面。

验证手段：

产品线提交故障应急响应组织方式和处置流程文档；将实际故障应急响应场景与应急响应文档要求进行对比。

判例：

无

指标级别：2

对应角色：OP